"use strict";var e=require("atom"),n=require("fs"),t=require("path"),r=require("child_process"),o=require("os");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,s=i(e),l=i(n),c=i(t),u=i(r),d=i(o),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},f={name:"pynsist",version:"0.11.0",description:"Snippets and build-system for pynsist, a tool to build Windows installers for your Python applications",license:"MIT OR GPL-2.0",scripts:{build:"rollup --config",dev:"npm run start","lint:coffee":"eslint --fix ./src/*.coffee","lint:cson":"eslint --fix ./grammars/*.cson ./snippets/*.cson",lint:"npm-run-all --parallel lint:*",prepare:"husky install",start:"rollup --config --watch",test:"npm run lint"},author:{name:"Jan T. Sott",url:"http://github.com/idleberg"},keywords:["pynsist","nsis","nullsoft","installer","python"],repository:{type:"git",url:"https://github.com/idleberg/atom-pynsist"},main:"lib/main",engines:{atom:">=1.0.0 <2.0.0"},"package-deps":[{name:"console",minimumVersion:"0.4.0"},{name:"console-panel"}],activationCommands:{"atom-workspace":["pynsist:generate-script","pynsist:compile-installer"]},activationHooks:["pynsist:grammar-used"],consumedServices:{console:{versions:{"^1.0.0":"consumeConsolePanel"}},"console-panel":{versions:{"^1.0.0":"consumeConsolePanel"}}},dependencies:{"atom-package-deps":"^8.0.0","atom-satisfy-dependencies":"^0.3.0"},devDependencies:{"@babel/core":"^7.15.0","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^20.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.4",coffeescript:"^2.5.1",eslint:"^7.32.0","eslint-plugin-coffee":"^0.1.14","eslint-plugin-json":"^3.1.0",husky:"^7.0.1","lint-staged":"^11.1.2","npm-run-all":"^4.1.5",rollup:"^2.56.2","rollup-plugin-coffee-script":"^2.0.0","rollup-plugin-terser":"^7.0.2"},husky:{hooks:{"pre-commit":"npm run test"}}},m=a={getConfig:function(e=""){var n;return n=f,null!=e?atom.config.get(`${n.name}.${e}`):atom.config.get(`${n.name}`)},clearConsole:function(e){try{return e.clear()}catch(e){if(a.getConfig("clearConsole"))return console.clear()}},detectOutput:function(e,n,t){var r,o,i;return({existsSync:o}=l.default),({join:i}=c.default),-1!==n.indexOf(t.string)&&!0===o(r=i(e,t.regex.exec(n.toString())[1]))?r:""},getPath:function(e){var n,t,r;return({spawn:t}=u.default),(n=a.getConfig("pathToPynsist")).length>0&&"pynsist"!==n?e(n):((r=t(a.which(),["pynsist"])).stdout.on("data",(function(n){var t;return t=n.toString().trim(),atom.config.set("pynsist.pathToPynsist",t),e(t)})),r.on("close",(function(e){if(e>0)return a.isPathSetup()})))},isPathSetup:function(){var e,n;return({access:e,constants:n}=l.default),e(a.getConfig("pathToPynsist"),n.R_OK|n.W_OK,(function(e){var n;if(e)return n=atom.notifications.addWarning("**pynsist**: No valid `pynsist` was specified in your settings or your is not in your `PATH` [environmental variable](http://superuser.com/a/284351/195953)",{dismissable:!0,buttons:[{text:"Open Settings",className:"icon icon-gear",onDidClick:function(){return atom.workspace.open("atom://config/packages/pynsist",{pending:!0,searchAllPanes:!0}),n.dismiss()}},{text:"Ignore",onDidClick:function(){return atom.config.set("pynsist.mutePathWarning",!0),n.dismiss()}}]})}))},notifyOnSucess:function(e,n){var t,r,o,i;if(({platform:i}=d.default),t=[],""!==n?(r="Successfully compiled installer","win32"!==i()&&!0!==a.getConfig("useWineToRun")||t.push({text:"Run Installer",className:"icon icon-playback-play",onDidClick:function(){return a.runInstaller(n),o.dismiss()}})):r="Successfully generated script",t.push({text:"Open Script",className:"icon icon-pencil",onDidClick:function(){return atom.workspace.open(e),o.dismiss()}},{text:"Cancel",onDidClick:function(){return o.dismiss()}}),a.getConfig("showBuildNotifications"))return o=atom.notifications.addSuccess(r,{dismissable:!0,buttons:t})},runInstaller:function(e){var n,t,r;if(({spawn:r}=u.default),({platform:t}=d.default),"win32"===t())try{return r(e,{shell:!0})}catch(e){return n=e,atom.notifications.addWarning("**pynsist**",{detail:n,dismissable:!0})}else if(!0===a.getConfig("useWineToRun"))try{return r("wine",[e])}catch(e){return n=e,atom.notifications.addWarning("**pynsist**",{detail:n,dismissable:!0})}},which:function(){var e;return({platform:e}=d.default),"win32"===e()?"where":"which"}},g={generate:function(e,n){var t,r,o,i,a,s,l,d,p,f,g,y;if(({clearConsole:r,detectOutput:o,getConfig:s,getPath:l,notifyOnSucess:d}=m),({spawn:y}=u.default),({dirname:i}=c.default),null!=(a=atom.workspace.getActiveTextEditor()))return f=a.getPath(),g=i(f),t=[f],p=a.getGrammar().scopeName,!1===n&&t.push("--no-makensis"),null!=f&&"source.cfg.pynsist"===p?(a.isModified()&&a.save(),l((function(i){var a,l,c;return r(e),c=y(i,t),a="",l="",c.stdout.on("data",(function(n){try{return e.log(n.toString())}catch(e){return console.log(n.toString())}})),c.stderr.on("data",(function(t){try{e.log(t.toString())}catch(e){console.log(t.toString())}if(""===l&&(l=o(g,t,{string:"Writing NSI file to ",regex:/Writing NSI file to (.*)\r?\n/g})),""===a&&!0===n)return a=o(g,t,{string:"Installer written to ",regex:/Installer written to (.*)\r?\n/g})})),c.on("exit",(function(e){var n;if(0===e&&""!==l){if(s("showBuildNotifications"))return d(l,a)}else if(s("showBuildNotifications"))return n=atom.notifications.addError("**pynsist**",{detail:"Something went wrong. See the console for details.",dismissable:!0,buttons:[{text:"Open Console",className:"icon icon-code",onDidClick:function(){return atom.openDevTools(),n.dismiss()}},{text:"Cancel",onDidClick:function(){return n.dismiss()}}]})}))}))):atom.beep();atom.notifications.addWarning("**pynsist**: No active editor",{dismissable:!1})}},y={},h={};Object.defineProperty(h,"__esModule",{value:!0});var w=d.default,v=u.default,b=l.default,k=c.default;function P(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var E=P(w),S=P(b),x=P(k);const C=/\s+at.*(?:\(|\s)(.*)\)?/,D=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,T=void 0===E.default.homedir?"":E.default.homedir();class N extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError("Expected input to be an Array, got "+typeof e);let n=(e=[...e].map((e=>e instanceof Error?e:null!==e&&"object"==typeof e?Object.assign(new Error(e.message),e):new Error(e)))).map((e=>{return"string"==typeof e.stack?(e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,""))((n=e.stack,t=Object.assign({pretty:!1},t),n.replace(/\\/g,"/").split("\n").filter((e=>{const n=e.match(C);if(null===n||!n[1])return!0;const t=n[1];return!t.includes(".app/Contents/Resources/electron.asar")&&!t.includes(".app/Contents/Resources/default_app.asar")&&!D.test(t)})).filter((e=>""!==e.trim())).map((e=>t.pretty?e.replace(C,((e,n)=>e.replace(n,n.replace(T,"~")))):e)).join("\n"))):String(e);var n,t})).join("\n");n="\n"+((e,n=1,t)=>{if(t={indent:" ",includeEmptyLines:!1,...t},"string"!=typeof e)throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if("number"!=typeof n)throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof n}\``);if("string"!=typeof t.indent)throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof t.indent}\``);if(0===n)return e;const r=t.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return e.replace(r,t.indent.repeat(n))})(n,4),super(n),this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}var j=N;const $=(e,n,t)=>new Promise(((r,o)=>{if(t=Object.assign({concurrency:1/0},t),"function"!=typeof n)throw new TypeError("Mapper function is required");const{concurrency:i}=t;if(!("number"==typeof i&&i>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${i}\` (${typeof i})`);const a=[],s=e[Symbol.iterator]();let l=!1,c=!1,u=0,d=0;const p=()=>{if(l)return;const e=s.next(),t=d;if(d++,e.done)return c=!0,void(0===u&&r(a));u++,Promise.resolve(e.value).then((e=>n(e,t))).then((e=>{a[t]=e,u--,p()}),(e=>{l=!0,o(e)}))};for(let e=0;e<i&&(p(),!c);e++);}));var A=$,O=$;A.default=O;const I=async(e,n,t)=>(await A(e,((e,t)=>Promise.all([n(e,t),e])),t)).filter((e=>Boolean(e[0]))).map((e=>e[1]));var _=I,M=I;_.default=M;const W="undefined"!=typeof atom,q="undefined"!=typeof atom&&(atom.inDevMode()||atom.inSpecMode());
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */
var V=/["'&<>]/,F=function(e){var n,t=""+e,r=V.exec(t);if(!r)return t;var o="",i=0,a=0;for(i=r.index;i<t.length;i++){switch(t.charCodeAt(i)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&#39;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}a!==i&&(o+=t.substring(a,i)),a=i+1,o+=n}return a!==i?o+t.substring(a,i):o};function L(e,n,t){let r;const o=async function(e,n,t){const r=v.spawn(e,n,t),o=new Promise(((e,n)=>{const o={stdout:r.stdout?[]:null,stderr:r.stderr?[]:null};r.on("error",n),r.stdout&&r.stdout.on("data",(function(e){o.stdout.push(e),t.handleStdout&&t.handleStdout(e)})),r.stderr&&r.stderr.on("data",(function(e){o.stderr.push(e),t.handleStderr&&t.handleStderr(e)})),r.on("close",(n=>{let r=null;null!=o.stdout&&(r=null===t.encoding||"buffer"===t.encoding?Buffer.concat(o.stdout):o.stdout.join(""));let i=null;null!=o.stderr&&(i=null===t.encoding||"buffer"===t.encoding?Buffer.concat(o.stderr):o.stderr.join("")),e({exitCode:n,stdout:r,stderr:i})}))}));return t.handleChildProcess(r),o}(e,n,{...t,handleChildProcess(e){r=e}});return o.kill=function(e){return r.kill(e)},o}async function B(e){if(W){const n=await async function(e){var n;const t=atom.packages.getLoadedPackage(e.name);return null==t?null:null!==(n=t.metadata.version)&&void 0!==n?n:null}(e);if(n)return n}return async function(e){var n,t;const{directory:r}=e;if(null==r)return null;let o=null;try{o=JSON.parse(await S.default.promises.readFile(x.default.join(r,"package.json"),"utf8"))}catch(e){return null}return null!==(n=null===(t=o)||void 0===t?void 0:t.version)&&void 0!==n?n:null}(e)}const R=W?async function(e){return atom.packages.resolvePackagePath(e)}:async function(e){var n;const t=x.default.join(null!==(n=process.env.ATOM_HOME)&&void 0!==n?n:x.default.join(E.default.homedir(),".atom"),"packages",e);try{return await S.default.promises.access(t,S.default.constants.R_OK),t}catch(e){return null}};function H(e,n){if(!e)throw new Error(null!=n?n:"Invariant violation")}async function J(e){const n=await(W?async function(e){const n=atom.packages.getLoadedPackage(e),t=n&&n.metadata["package-deps"];return Array.isArray(t)?t:[]}(e):async function(e){let n=null;try{n=await S.default.promises.stat(e)}catch(e){}if(null==n||!n.isDirectory())throw new Error("[Package-Deps] Expected packageName to be a readable directory in Node.js invocation");let t=null;try{const n=await S.default.promises.readFile(x.default.join(e,"package.json"),"utf8");t=JSON.parse(n)}catch(e){}const r=null==t||"object"!=typeof t?[]:t["package-deps"];return Array.isArray(r)?r:[]}(e));return q&&(H(Array.isArray(n),`Dependencies for ${e} are not a valid array`),n.forEach(((n,t)=>{if(Array.isArray(n))n.forEach(((n,r)=>{const o=`Dependency#${t}#${r} for ${e} is invalid`;H("string"==typeof n.name&&n.name.length>0,o),H(null==n.minimumVersion||"string"==typeof n.minimumVersion&&n.minimumVersion.length>0,o)})),H(n.length>0,`Dependency#${t} for ${e} has no group items`);else{const r=`Dependency#${t} for ${e} is invalid`;H("string"==typeof n.name&&n.name.length>0,r),H(null==n.minimumVersion||"string"==typeof n.minimumVersion&&n.minimumVersion.length>0,r)}}))),n}async function U(e){if(null==e.directory)return!0;if(null==e.minimumVersion)return!1;const n=await B(e);return null==n||1===function(e,n){for(var t=e.split("."),r=n.split("."),o=0;o<3;o++){var i=Number(t[o]),a=Number(r[o]);if(i>a)return 1;if(a>i)return-1;if(!isNaN(i)&&isNaN(a))return 1;if(isNaN(i)&&!isNaN(a))return-1}return 0}(e.minimumVersion,n)}const G=new Set(["✓","done"]),K=/(?:Installing|Moving) (.*?) to .* (.*)/;async function Y(e){if("string"==typeof e)return{name:e,directory:await R(e)};if("name"in e)return{...e,directory:await R(e.name)};throw console.error("This package-deps entry is not valid. Please see https://github.com/steelbrain/package-deps#how-it-works",{entry:e}),Error("The package-deps entry is not valid. Please see https://github.com/steelbrain/package-deps#how-it-works")}let z=!0;const Q=W?function({packageName:e,dependencies:n}){const t=[],r=atom.notifications.addInfo(`Installing ${e} dependencies`,{detail:`Installing ${n.map((e=>e.name)).join(", ")}`,dismissable:!0}),o=document.createElement("progress");o.max=n.length,o.style.width="100%";try{var i;const e=atom.views.getView(r),n=null!==(i=null==e?void 0:e.element)&&void 0!==i?i:null;if(null==n)throw new Error("Unable to get notification element from view");const t=n.querySelector(".detail-content");if(null==t)throw new Error("Content detail container not found inside the notification");t.appendChild(o)}catch(e){console.error("[Package-Deps] Error during showing installation progress to user",e)}return{handleFailure({dependency:e,error:n}){var r;t.push(e.name),o.value+=1,console.error(`[Package-Deps] Unable to install ${e.name}, Error:`,null!==(r=null==n?void 0:n.stack)&&void 0!==r?r:n)},handleDependencyInstalled(e){o.value+=1},handleComplete(){r.dismiss(),t.length>0?atom.notifications.addWarning(`Failed to install ${e} dependencies`,{detail:`These packages were not installed, check your console\nfor more info.\n${t.join("\n")}`,dismissable:!0}):atom.notifications.addSuccess(`Installed ${e} dependencies`,{detail:`Installed ${n.map((e=>e.name)).join(", ")}`}),Promise.all(n.map((e=>t.includes(e.name)?null:atom.packages.activatePackage(e.name)))).catch((n=>{console.error(`[Package-Deps] Error activating installed packages for ${e}`,n)}))}}}:function({dependencies:e}){let n=!1;return console.log(`Installing dependencies:\n${e.map((e=>`  - ${e.name}`)).join("\n")}`),{handleFailure({dependency:e,error:t}){var r;n=!0,console.error(`Unable to install ${e.name}, Error:`,null!==(r=null==t?void 0:t.stack)&&void 0!==r?r:t)},handleDependencyInstalled(e){console.log("Successfully installed",e.name)},handleComplete(){console.log("Installation complete"),n&&(process.exitCode=1)}}},X=W?function({packageName:e,dependencies:n}){return new Promise((t=>{const r=n.filter((e=>!Array.isArray(e))),o=n.filter((e=>Array.isArray(e))),i=0===o.length,a=i?r.map((e=>e.name)).join(", "):"Something went wrong. Check your developer console",s=o.map((e=>e[0]));atom.packages.isPackageDisabled("notifications")&&console.warn(`Enable notifications to install dependencies for ${e}`);const l=atom.notifications.addInfo(`${e} needs to install dependencies`,{dismissable:!0,icon:"cloud-download",detail:a,description:`Install dependenc${1===n.length?"y":"ies"}?`,buttons:[{text:"Yes",onDidClick:()=>{t(i?r:r.concat(s)),l.dismiss()}},{text:"No Thanks",onDidClick:()=>{l.dismiss()}},{text:"Never",onDidClick:()=>{!function(e){var n;if(!W)return;const t=new Set(null!==(n=atom.config.get("atom-package-deps.ignored"))&&void 0!==n?n:[]);t.add(e),atom.config.set("atom-package-deps.ignored",Array.from(t))}(e),z&&(z=!1,atom.notifications.addInfo("How to reset package-deps memory",{dismissable:!0,description:"To modify the list of ignored files invoke 'Application: Open Your Config' and change the 'atom-package-deps' section"})),l.dismiss()}}]});if(l.onDidDismiss((()=>t([]))),!i)try{var c;const e=atom.views.getView(l),n=null!==(c=null==e?void 0:e.element)&&void 0!==c?c:null;if(null==n)throw new Error("Unable to get notification element from view");const t=n.querySelector(".detail-content");if(null==t)throw new Error("Content detail container not found inside the notification");if(t.innerHTML="",r.length>0){const e=document.createElement("div");e.innerHTML=`Packages without choices: <br /><ul><li>${r.map((e=>F(e.name))).join("</li><li>")}</li></ul>`,t.appendChild(e)}const i=document.createElement("div");i.innerHTML="Packages with choices:",t.appendChild(i);const a=document.createElement("ul");o.forEach(((e,n)=>{const t=document.createElement("li"),r=document.createElement("select");r.innerHTML=e.map((e=>`<option>${F(e.name)}</option>`)).join("\n"),r.addEventListener("change",(()=>{const t=e.find((e=>e.name===r.value));null!=t&&(s[n]=t)})),t.style.marginTop="5px",t.appendChild(r),a.appendChild(t)})),t.appendChild(a)}catch(e){console.error("[Package-Deps] Error during showing package choices to user",e)}}))}:async function({dependencies:e}){return e.map((e=>Array.isArray(e)?e[0]:e))};h.install=async function(e,n=!1){if(H("string"==typeof e&&e.length>0,"[Package-Deps] Package name is required"),function(e){var n;return!!W&&!!(null!==(n=atom.config.get("atom-package-deps.ignored"))&&void 0!==n?n:[]).includes(e)}(e))return;const t=await J(e);if(0===t.length)return;const r=await Promise.all(t.map((async e=>Array.isArray(e)?Promise.all(e.map(Y)):Y(e)))),o=await _(r,(async function(e){return Array.isArray(e)?(await Promise.all(e.map((e=>U(e))))).every(Boolean):U(e)}));if(0===o.length)return;let i;if(i=n?o.map((e=>Array.isArray(e)?e[0]:e)):await X({packageName:e,dependencies:o}),0===i.length)return;const a=Q({packageName:e,dependencies:i});await(async(e,n,{concurrency:t=1/0,stopOnError:r=!0}={})=>new Promise(((o,i)=>{if("function"!=typeof n)throw new TypeError("Mapper function is required");if(!Number.isSafeInteger(t)&&t!==1/0||!(t>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${t}\` (${typeof t})`);const a=[],s=[],l=e[Symbol.iterator]();let c=!1,u=!1,d=0,p=0;const f=()=>{if(c)return;const e=l.next(),t=p;if(p++,e.done)return u=!0,void(0===d&&(r||0===s.length?o(a):i(new j(s))));d++,(async()=>{try{const r=await e.value;a[t]=await n(r,t),d--,f()}catch(e){r?(c=!0,i(e)):(s.push(e),d--,f())}})()};for(let e=0;e<t&&(f(),!u);e++);})))(i,(async function(e){try{await async function(e){const n=W?`"${atom.packages.getApmPath()}"`:"apm",{stdout:t,stderr:r}=await L(n,["install",e.name,"--production","--color","false"],{shell:!0}),o=K.exec(t.trim());if(null!=o&&G.has(o[2]))return;const i=new Error(`Error installing dependency: ${e.name}`);throw i.stack=r.trim(),i}(e),a.handleDependencyInstalled(e)}catch(n){a.handleFailure({dependency:e,error:n})}}),{concurrency:2}),a.handleComplete()};var Z={},ee={exports:{}};const ne=()=>{const e=Error.prepareStackTrace;Error.prepareStackTrace=(e,n)=>n;const n=(new Error).stack.slice(1);return Error.prepareStackTrace=e,n};ee.exports=ne,ee.exports.default=ne;const te=ee.exports;var re=p&&p.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}l((r=r.apply(e,n||[])).next())}))},oe=p&&p.__generator||function(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(Z,"__esModule",{value:!0}),Z.readManifestSync=Z.readManifest=void 0;var ie=c.default,ae=ie.resolve,se=ie.sep,le=l.default,ce=le.promises,ue=le.readFileSync,de=({depth:e=0}={})=>{const n=[],t=new Set;for(const r of te()){const o=r.getFileName(),i=null!==r.getTypeName()&&null!==o;if(t.has(o)||(t.add(o),n.unshift(r)),i)return n[e]}};function pe(e){e=(null==e?void 0:e.length)?e:function(){var e=de().getFileName(),n=atom.packages.getPackageDirPaths().filter((function(n){return e.startsWith(n)}));if(null==n?void 0:n.length)return e.replace(n[0],"").split(se).filter((function(e){return e}))[0]||"";return""}();var n=atom.packages.resolvePackagePath(e);return ae(n,"package.json")}Z.readManifest=function(e){return void 0===e&&(e=""),re(this,void 0,void 0,(function(){var n,t;return oe(this,(function(r){switch(r.label){case 0:n=pe(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,ce.readFile(n,"utf8")];case 2:return t=r.sent(),[2,JSON.parse(t)];case 3:return r.sent(),[2,null];case 4:return[2]}}))}))},Z.readManifestSync=function(e){void 0===e&&(e="");var n=pe(e);try{var t=ue(n,"utf8");return JSON.parse(t)}catch(e){return null}};var fe=p&&p.__assign||function(){return(fe=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},me=p&&p.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}l((r=r.apply(e,n||[])).next())}))},ge=p&&p.__generator||function(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(y,"__esModule",{value:!0}),y.satisfyDependencies=void 0;var ye=h,he=Z,we={logger:console.log};y.satisfyDependencies=function(e,n){return void 0===n&&(n={}),me(this,void 0,void 0,(function(){var t,r;return ge(this,(function(o){switch(o.label){case 0:return t=fe(fe({},we),n),[4,he.readManifest(e)];case 1:return r=o.sent(),[4,ye.install(r.name)];case 2:return o.sent(),function(e,n){n.enableDependencies&&e["package-deps"].map((function(t){atom.packages.isPackageDisabled(t)&&(atom.inDevMode()&&n.logger("["+e.name+"] Enabling package dependency '"+t+"'"),atom.packages.enablePackage(t))}))}(r["package-deps"],t),[2]}}))}))};var ve={config:{pathToPynsist:{title:"Path To Pynsist",description:"Specify the full path to `pynsist`",type:"string",default:"pynsist",order:0},mutePathWarning:{title:"Mute Path Warning",description:"When enabled, warnings about missing path to `pynsist` will be muted",type:"boolean",default:!1,order:1},showBuildNotifications:{title:"Show Build Notifications",description:"Displays color-coded notifications that close automatically after 5 seconds",type:"boolean",default:!0,order:2},clearConsole:{title:"Clear Console",description:"When `console-panel` isn't available, build logs will be printed using `console.log()`. This setting clears the console prior to building.",type:"boolean",default:!0,order:3},useWineToRun:{title:"Use Wine to run",description:"When on a non-Windows platform, you can run compiled installers using [Wine](https://www.winehq.org/)",type:"boolean",default:!1,order:4},manageDependencies:{title:"Manage Dependencies",description:"When enabled, third-party dependencies will be installed automatically",type:"boolean",default:!0,order:5}},subscriptions:null,activate:function(){var e,n,t,r,o,i;if(({CompositeDisposable:e}=s.default),({generate:n}=g),({getConfig:t,isPathSetup:r}=m),({platform:o}=d.default),({satisfyDependencies:i}=y),this.subscriptions=new e,this.subscriptions.add(atom.commands.add("atom-workspace",{"pynsist:generate-script":()=>n(this.consolePanel,!1)})),this.subscriptions.add(atom.commands.add("atom-workspace",{"pynsist:compile-installer":()=>n(this.consolePanel,!0)})),!0===t("manageDependencies")&&i("pynsist"),!1===t("mutePathWarning")&&"win32"===o())return r()},deactivate:function(){var e;return null!=(e=this.subscriptions)&&e.dispose(),this.subscriptions=null},consumeConsolePanel:function(e){this.consolePanel=e}};module.exports=ve;
